---
title: "next-mdx-remote"
---

ä¸€ç»„è½»å‹å®ç”¨ç¨‹åºï¼Œå…è®¸åœ¨`getStaticProps`æˆ–`getServerSideProps`ä¸­åŠ è½½ mdxï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ä¸Šæ­£ç¡®æ°´åˆã€‚

---

## å®‰è£…

```sh
# using npm
npm i next-mdx-remote

# using yarn
yarn add next-mdx-remote
```

## ç¤ºä¾‹

```jsx
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote } from "next-mdx-remote";

import Test from "../components/test";

const components = { Test };

export default function TestPage({ source }) {
  return (
    <div className="wrapper">
      <MDXRemote {...source} components={components} />
    </div>
  );
}

export async function getStaticProps() {
  // MDX text - can be from a local file, database, anywhere
  const source = "Some **mdx** text, with a component <Test />";
  const mdxSource = await serialize(source);
  return { props: { source: mdxSource } };
}
```

è™½ç„¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­çœ‹åˆ°è¿™ä¸¤ä¸ªå¯èƒ½çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½†è¿™æ˜¯ Next.js çš„ä¸€ä¸ªå¾ˆé…·çš„åœ°æ–¹â€”â€”`getStaticProps`å’Œ`TestPage`ï¼Œè™½ç„¶å‡ºç°åœ¨åŒä¸€æ–‡ä»¶ä¸­ï¼Œä½†åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹è¿è¡Œã€‚æœ€ç»ˆï¼Œæ‚¨çš„æµè§ˆå™¨æ†ç»‘åŒ…å°†å®Œå…¨ä¸åŒ…æ‹¬`getStaticProps`ï¼Œä¹Ÿä¸åŒ…æ‹¬å®ƒä»…åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨çš„ä»»ä½•å‡½æ•°ï¼Œå› æ­¤`serialize`å°†å®Œå…¨ä»æµè§ˆå™¨æ†ç»‘åŒ…ä¸­åˆ é™¤ã€‚

> **IMPORTANT**: å°†ä»»ä½•`mdx-remote`ä»£ç æ”¾å…¥å•ç‹¬çš„`å®ç”¨ç¨‹åº`æ–‡ä»¶æ—¶è¦éå¸¸å°å¿ƒã€‚è¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´ nextjs çš„ä»£ç åˆ†å‰²èƒ½åŠ›å‡ºç°é—®é¢˜â€”â€”å®ƒå¿…é¡»èƒ½å¤Ÿæ¸…æ¥šåœ°ç¡®å®šå“ªäº›åªåœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼Œå“ªäº›åº”è¯¥ç•™åœ¨å®¢æˆ·ç«¯æ†ç»‘åŒ…ä¸­ã€‚å¦‚æœå°†`mdx-remote`ä»£ç æ”¾å…¥å¤–éƒ¨å®ç”¨ç¨‹åºæ–‡ä»¶ä¸­ï¼Œä½†æŸäº›å†…å®¹å·²æŸåï¼Œè¯·å°†å…¶åˆ é™¤ï¼Œç„¶ååœ¨æäº¤é—®é¢˜ä¹‹å‰ä»ä¸Šé¢çš„ç®€å•ç¤ºä¾‹å¼€å§‹ã€‚

### å…¶ä»–ç¤ºä¾‹

<details>
  <summary>æ­£åœ¨åˆ†æFrontmatter</summary>

Markdown é€šå¸¸ä¸ frontmatter é…å¯¹ï¼Œé€šå¸¸è¿™æ„å‘³ç€åœ¨å¤„ç† Markdown çš„æ–¹å¼ä¸­æ·»åŠ ä¸€äº›é¢å¤–çš„è‡ªå®šä¹‰å¤„ç†ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ`next-mdx-remote`æä¾›äº†å¯é€‰çš„ frontmatter è§£æï¼Œå¯ä»¥é€šè¿‡å°†`parseFrontmatter: true`ä¼ é€’ç»™`serialize`æ¥å¯ç”¨ã€‚

è¿™æ˜¯å®ƒçš„æ ·å­:

```jsx
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote } from "next-mdx-remote";

import Test from "../components/test";

const components = { Test };

export default function TestPage({ mdxSource }) {
  return (
    <div className="wrapper">
      <h1>{mdxSource.frontmatter.title}</h1>
      <MDXRemote {...mdxSource} components={components} />
    </div>
  );
}

export async function getStaticProps() {
  // MDX text - can be from a local file, database, anywhere
  const source = `---
title: Test
---

Some **mdx** text, with a component <Test name={frontmatter.title}/>
  `;

  const mdxSource = await serialize(source, { parseFrontmatter: true });
  return { props: { mdxSource } };
}
```

_[`vfile-matter`](https://github.com/vfile/vfile-matter) ç”¨äºè§£æå‰é¢çš„å†…å®¹._

</details>

<details>
  <summary>å°†è‡ªå®šä¹‰æ•°æ®ä¼ é€’ç»™å…·æœ‰`scope`çš„ç»„ä»¶`</summary>

`<MDXRemote />`æ¥å—ä¸€ä¸ª`scope`å±æ€§ï¼Œå®ƒä½¿æ‰€æœ‰å€¼éƒ½å¯åœ¨ MDX ä¸­ä½¿ç”¨ã€‚

`scope`å‚æ•°ä¸­çš„æ¯ä¸ªé”®/å€¼å¯¹éƒ½å°†ä½œä¸º javascript å˜é‡å…¬å¼€ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªç±»ä¼¼äº`{ foo: 'bar' }`çš„ä½œç”¨åŸŸï¼Œå®ƒå°†è¢«è§£é‡Šä¸º`const foo = 'bar'`ã€‚

è¿™ç‰¹åˆ«æ„å‘³ç€æ‚¨éœ€è¦ç¡®ä¿`scope`å‚æ•°ä¸­çš„é”®åæ˜¯æœ‰æ•ˆçš„ javascript å˜é‡åã€‚ä¾‹å¦‚ï¼Œä¼ å…¥`{ 'my-variable-name': 'bar' }`ä¼šäº§ç”Ÿ*é”™è¯¯*ï¼Œå› ä¸ºé”®åä¸æ˜¯æœ‰æ•ˆçš„ javascript å˜é‡åã€‚

è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`scope`å˜é‡å¿…é¡»ä½œä¸ºç»„ä»¶çš„å‚æ•°ä½¿ç”¨ï¼Œä¸èƒ½åœ¨æ–‡æœ¬ä¸­é—´å‘ˆç°ã€‚è¿™åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­æ˜¾ç¤ºã€‚

```jsx
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote } from "next-mdx-remote";

import Test from "../components/test";

const components = { Test };
const data = { product: "next" };

export default function TestPage({ source }) {
  return (
    <div className="wrapper">
      <MDXRemote {...source} components={components} scope={data} />
    </div>
  );
}

export async function getStaticProps() {
  // MDX text - can be from a local file, database, anywhere
  const source = "Some **mdx** text, with a component using a scope variable <Test product={product} />";
  const mdxSource = await serialize(source);
  return { props: { source: mdxSource } };
}
```

</details>

<details>
  <summary>å°†`scope`ä¼ é€’åˆ°`serialize`å‡½æ•°</summary>

æ‚¨è¿˜å¯ä»¥å°†è‡ªå®šä¹‰æ•°æ®ä¼ é€’åˆ°`serialize`ä¸­ï¼Œåè€…å°†ä¼ é€’å€¼å¹¶ä½¿å…¶ä»ç»“æœä¸­å¯ç”¨ã€‚é€šè¿‡å°†ç»“æœä»`source`æ‰©å±•åˆ°`<MDXRemote />`ï¼Œæ•°æ®å°†å¯ç”¨ã€‚

è¯·æ³¨æ„ï¼Œä¼ é€’åˆ°`serialize`çš„ä»»ä½•ä½œç”¨åŸŸå€¼éƒ½éœ€è¦æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œè¿™æ„å‘³ç€ä¼ é€’å‡½æ•°æˆ–ç»„ä»¶æ˜¯ä¸å¯èƒ½çš„ã€‚æ­¤å¤–ï¼Œ`scope`å‚æ•°ä¸­å‘½åçš„ä»»ä½•é”®éƒ½å¿…é¡»æ˜¯æœ‰æ•ˆçš„ javascript å˜é‡åã€‚å¦‚æœéœ€è¦ä¼ é€’ä¸å¯åºåˆ—åŒ–çš„è‡ªå®šä¹‰ä½œç”¨åŸŸï¼Œå¯ä»¥å°†`scope`ç›´æ¥ä¼ é€’åˆ°`<MDXRemote />'`ä¸­è¿›è¡Œæ¸²æŸ“ã€‚æœ¬èŠ‚ä¸Šé¢æœ‰ä¸€ä¸ªå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ç¤ºä¾‹ã€‚

```jsx
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote } from "next-mdx-remote";

import Test from "../components/test";

const components = { Test };
const data = { product: "next" };

export default function TestPage({ source }) {
  return (
    <div className="wrapper">
      <MDXRemote {...source} components={components} />
    </div>
  );
}

export async function getStaticProps() {
  // MDX text - can be from a local file, database, anywhere
  const source = "Some **mdx** text, with a component <Test product={product} />";
  const mdxSource = await serialize(source, { scope: data });
  return { props: { source: mdxSource } };
}
```

</details>

<details>
  <summary>
    <code>MDXProvider</code>ä¸­çš„è‡ªå®šä¹‰ç»„ä»¶<a id="mdx-provider"></a>
  </summary>

å¦‚æœè¦ä½¿ç»„ä»¶å¯ç”¨äºåº”ç”¨ç¨‹åºä¸­å‘ˆç°çš„ä»»ä½•`<MDXRemote />`ï¼Œå¯ä»¥ä½¿ç”¨`@mdx-js/react`ä¸­çš„[`<MDXProvider />`](https://mdxjs.com/docs/using-mdx/#mdx-provider)ã€‚

```jsx
// pages/_app.jsx
import { MDXProvider } from "@mdx-js/react";

import Test from "../components/test";

const components = { Test };

export default function MyApp({ Component, pageProps }) {
  return (
    <MDXProvider components={components}>
      <Component {...pageProps} />
    </MDXProvider>
  );
}
```

```jsx
// pages/test.jsx
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote } from "next-mdx-remote";

export default function TestPage({ source }) {
  return (
    <div className="wrapper">
      <MDXRemote {...source} />
    </div>
  );
}

export async function getStaticProps() {
  // MDX text - can be from a local file, database, anywhere
  const source = "Some **mdx** text, with a component <Test />";
  const mdxSource = await serialize(source);
  return { props: { source: mdxSource } };
}
```

</details>

<details>
  <summary>
    å¸¦ç‚¹çš„ç»„ä»¶åç§° (e.g. <code>motion.div</code>)
  </summary>

åŒ…å«ç‚¹çš„ç»„ä»¶åç§° (`.`), ä¾‹å¦‚æ¥è‡ª`framer-motion`çš„é‚£äº›, å¯ä»¥ä»¥ä¸å…¶ä»–è‡ªå®šä¹‰ç»„ä»¶ç›¸åŒçš„æ–¹å¼è¿›è¡Œæ¸²æŸ“ï¼Œåªéœ€åœ¨ç»„ä»¶å¯¹è±¡ä¸­ä¼ é€’`motion`å³å¯ã€‚

```js
import { motion } from "framer-motion";

import { MDXProvider } from "@mdx-js/react";
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote } from "next-mdx-remote";

export default function TestPage({ source }) {
  return (
    <div className="wrapper">
      <MDXRemote {...source} components={{ motion }} />
    </div>
  );
}

export async function getStaticProps() {
  // MDX text - can be from a local file, database, anywhere
  const source = `Some **mdx** text, with a component:

<motion.div animate={{ x: 100 }} />`;
  const mdxSource = await serialize(source);
  return { props: { source: mdxSource } };
}
```

</details>

<details>
  <summary>æ‡’æ•£çš„æ°´åˆä½œç”¨</summary>

æ‡’æƒ°çš„æ°´åˆä½œç”¨ä¼šæ¨è¿Ÿå®¢æˆ·ç«¯ç»„ä»¶çš„æ°´åˆä½œç”¨ã€‚è¿™æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºæé«˜åº”ç”¨ç¨‹åºçš„åˆå§‹è´Ÿè½½ï¼Œä½†å¯èƒ½ä¼šåœ¨ MDX å†…å®¹ä¸­çš„ä»»ä½•åŠ¨æ€å†…å®¹çš„äº¤äº’ä¸­å¼•å…¥æ„å¤–å»¶è¿Ÿã€‚

_ç¬”è®°: è¿™å°†åœ¨æ¸²æŸ“çš„ MDX å‘¨å›´æ·»åŠ ä¸€ä¸ªé¢å¤–çš„åŒ…è£…`div`ï¼Œè¿™å¯¹äºé¿å…[æ¸²æŸ“è¿‡ç¨‹ä¸­çš„æ°´åˆä¸åŒ¹é…](https://reactjs.org/docs/react-dom.html#hydrate)æ˜¯å¿…è¦çš„._

```jsx
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote } from "next-mdx-remote";

import Test from "../components/test";

const components = { Test };

export default function TestPage({ source }) {
  return (
    <div className="wrapper">
      <MDXRemote {...source} components={components} lazy />
    </div>
  );
}

export async function getStaticProps() {
  // MDX text - can be from a local file, database, anywhere
  const source = "Some **mdx** text, with a component <Test />";
  const mdxSource = await serialize(source);
  return { props: { source: mdxSource } };
}
```

</details>

## APIs

æ­¤åº“å…¬å¼€äº†ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªç»„ä»¶`serialize`å’Œ`<MDXRemote />`ã€‚ è¿™ä¸¤ä¸ªè¢«æœ‰æ„åœ°éš”ç¦»åˆ°å„è‡ªçš„æ–‡ä»¶ä¸­ -- `serialize `æ—¨åœ¨è¿è¡Œ**æœåŠ¡å™¨ç«¯**, å› æ­¤åœ¨`getStaticProps`ä¸­ï¼Œå®ƒåœ¨æœåŠ¡å™¨/æ„å»ºæ—¶è¿è¡Œã€‚å¦ä¸€æ–¹é¢`<MDXRemote />`æ—¨åœ¨åœ¨å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸­è¿è¡Œã€‚

- **`serialize(source: string, { mdxOptions?: object, scope?: object, parseFrontmatter?: boolean })`**

  **`serialize`** ä½¿ç”¨ä¸€ä¸ª MDX å­—ç¬¦ä¸²ã€‚å®ƒä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°è¢«ä¼ é€’[ç›´æ¥ä¼ é€’ç»™ MDX](https://mdxjs.com/docs/extending-mdx/)çš„é€‰é¡¹, ä»¥åŠå¯ä»¥åŒ…æ‹¬åœ¨ mdx ä½œç”¨åŸŸä¸­çš„ä½œç”¨åŸŸå¯¹è±¡ã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªè¦ç›´æ¥ä¼ é€’åˆ°`<MDXRemote />`ä¸­çš„å¯¹è±¡ã€‚

  ```ts
  serialize(
    // Raw MDX contents as a string
    "# hello, world",
    // Optional parameters
    {
      // made available to the arguments of any custom mdx component
      scope: {},
      // MDX's available options, see the MDX docs for more info.
      // https://mdxjs.com/packages/mdx/#compilefile-options
      mdxOptions: {
        remarkPlugins: [],
        rehypePlugins: [],
        format: "mdx",
      },
      // Indicates whether or not to parse the frontmatter from the mdx source
      parseFrontmatter: false,
    }
  );
  ```

  è®¿é—® https://mdxjs.com/packages/mdx/#compilefile-options ä»¥è·å–å¯ç”¨çš„`mdxOptions`ã€‚

- **`<MDXRemote compiledSource={string} components?={object} scope?={object} lazy?={boolean} />`**

  **`<MDXRemote />`**ä½¿ç”¨`serialize`çš„è¾“å‡ºä»¥åŠå¯é€‰çš„ç»„ä»¶å‚æ•°ã€‚å…¶ç»“æœå¯ä»¥ç›´æ¥æ¸²æŸ“åˆ°ç»„ä»¶ä¸­ã€‚è¦æ¨è¿Ÿå†…å®¹çš„æ°´åˆå¹¶ç«‹å³æä¾›é™æ€æ ‡è®°ï¼Œè¯·ä¼ é€’`lazy`å±æ€§ã€‚

  ```ts
  <MDXRemote {...source} components={components} />
  ```

### æ›¿æ¢é»˜è®¤ç»„ä»¶

æ¸²æŸ“å°†åœ¨åå°ä½¿ç”¨[`MDXProvider`](https://mdxjs.com/docs/using-mdx/#mdx-provider)ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ç”¨è‡ªå®šä¹‰ç»„ä»¶æ›¿æ¢ HTML æ ‡è®°ã€‚è¿™äº›ç»„ä»¶åœ¨ MDXJS[ç»„ä»¶è¡¨](https://mdxjs.com/table-of-components/)ä¸­åˆ—å‡º.

ä¸€ä¸ªç¤ºä¾‹ç”¨ä¾‹æ˜¯ä½¿ç”¨é¦–é€‰æ ·å¼åº“å‘ˆç°å†…å®¹ã€‚

```jsx
import { Typography } from "@material-ui/core";

const components = { Test, h2: (props) => <Typography variant="h2" {...props} /> }
...
```

å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥å°†æ•´ä¸ªåº”ç”¨ç¨‹åºåŒ…è£…åœ¨`<MDXProvider />`ä¸­ï¼Œè€Œä¸æ˜¯å°†ç»„ä»¶ç›´æ¥ä¼ é€’ç»™`<MDXRemote />`ã€‚ è¯·å‚é˜…ä¸Šé¢çš„[ç¤ºä¾‹](#mdx-provider)ã€‚

ç¬”è®°: ç”±äºç»„ä»¶åç§°ä¸­çš„`/`ï¼Œ`th/td`å°†æ— æ³•å·¥ä½œã€‚

## èƒŒæ™¯ä¸ç†è®º

åœ¨ Next.js åº”ç”¨ç¨‹åºä¸­åŠ è½½ mdx æ–‡ä»¶å¹¶æ²¡æœ‰ä¸€ä¸ªå¥½çš„é»˜è®¤æ–¹æ³•ã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬ç¼–å†™äº†[`next-mdx-enhanced`](https://github.com/hashicorp/next-mdx-enhanced)ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°† mdx æ–‡ä»¶æ¸²æŸ“åˆ°å¸ƒå±€ä¸­ï¼Œå¹¶å¯¼å…¥å®ƒä»¬çš„å‰ç«¯å†…å®¹ä»¥åˆ›å»ºç´¢å¼•é¡µã€‚

mdx å¢å¼ºç‰ˆçš„æ­¤å·¥ä½œæµå¾ˆå¥½ï¼Œä½†å¼•å…¥äº†ä¸€äº›é™åˆ¶ï¼Œè¿™äº›é™åˆ¶å·²é€šè¿‡`next-mdx-remote`åˆ é™¤ï¼š

- **æ–‡ä»¶å†…å®¹å¿…é¡»æ˜¯æœ¬åœ°çš„ã€‚** æ‚¨ä¸èƒ½å°† MDX æ–‡ä»¶å­˜å‚¨åœ¨å¦ä¸€ä¸ª repoã€æ•°æ®åº“ç­‰ä¸­ã€‚å¯¹äºä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ“ä½œï¼Œæœ€ç»ˆä¼šåœ¨åˆ›ä½œå†…å®¹çš„äººå’Œå¤„ç†å†…å®¹è¡¨ç¤ºçš„äººä¹‹é—´äº§ç”Ÿåˆ†æ­§ã€‚åœ¨åŒä¸€ä¸ª repo ä¸­é‡å è¿™ä¸¤ä¸ªå…³æ³¨ç‚¹ä¼šä½¿æ¯ä¸ªäººçš„å·¥ä½œæµç¨‹æ›´åŠ å›°éš¾ã€‚
- **æ‚¨å·²ç»‘å®šåˆ°åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¯ç”±ã€‚** æ‚¨çš„é¡µé¢æ˜¯æ ¹æ®ä½ç½®ç”Ÿæˆ URL çš„ã€‚ æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`exportPathMap`é‡æ–°æ˜ å°„å®ƒä»¬ï¼Œè¿™ä¼šç»™ä½œè€…å¸¦æ¥å›°æƒ‘ã€‚ æ— è®ºå¦‚ä½•ï¼Œä»¥ä»»ä½•æ–¹å¼ç§»åŠ¨é¡µé¢éƒ½ä¼šç ´åä¸€äº›ä¸œè¥¿â€”â€”è¦ä¹ˆæ˜¯é¡µé¢çš„ urlï¼Œè¦ä¹ˆæ˜¯æ‚¨çš„`exportPathMap`é…ç½®ã€‚
- **æ‚¨æœ€ç»ˆä¼šé‡åˆ°æ€§èƒ½é—®é¢˜ã€‚** Webpack æ˜¯ä¸€ä¸ª JavaScript æ†ç»‘å™¨ï¼Œå¼ºåˆ¶å®ƒåŠ è½½æˆç™¾ä¸Šåƒé¡µçš„æ–‡æœ¬å†…å®¹å°†è€—å°½æ‚¨çš„å†…å­˜éœ€æ±‚ã€‚Webpack å°†æ¯ä¸ªé¡µé¢å­˜å‚¨ä¸ºå…·æœ‰å¤§é‡å…ƒæ•°æ®çš„ä¸åŒå¯¹è±¡ã€‚æˆ‘ä»¬çš„ä¸€ä¸ªå®ç°æœ‰å‡ ç™¾ä¸ªé¡µé¢ï¼Œè¾¾åˆ°äº†ç¼–è¯‘ç½‘ç«™æ‰€éœ€çš„ 8GB ä»¥ä¸Šçš„å†…å­˜ã€‚æ„å»ºè€—æ—¶è¶…è¿‡ 25 åˆ†é’Ÿã€‚
- **æ‚¨å°†åœ¨æ„å»ºå…³ç³»æ•°æ®çš„æ–¹å¼ä¸Šå—åˆ°é™åˆ¶ã€‚** å½“æ‚¨çš„æ•´ä¸ªæ•°æ®ç»“æ„è¢«è§£æä¸º javascript å¯¹è±¡å¹¶ä¿å­˜åœ¨å†…å­˜ä¸­æ—¶ï¼Œå¾ˆéš¾å°†å†…å®¹ç»„ç»‡æˆåŠ¨æ€çš„ç›¸å…³ç±»åˆ«ã€‚

å› æ­¤ï¼Œ`next-mdx-remote`ä¼šæ›´æ”¹æ•´ä¸ªæ¨¡å¼ï¼Œä»¥ä¾¿æ‚¨ä¸é€šè¿‡å¯¼å…¥åŠ è½½ mdx å†…å®¹ï¼Œè€Œæ˜¯é€šè¿‡`getStaticProps`æˆ–`getServerProps`åŠ è½½ mdx å±æ€§ -- æ‚¨çŸ¥é“ï¼Œè¿™ä¸åŠ è½½ä»»ä½•å…¶ä»–æ•°æ®çš„æ–¹å¼ç›¸åŒã€‚è¯¥åº“æä¾›äº†ä»¥é«˜æ€§èƒ½çš„æ–¹å¼åºåˆ—åŒ–å’Œæ°´åˆ MDX å†…å®¹çš„å·¥å…·ã€‚è¿™æ¶ˆé™¤äº†ä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰é™åˆ¶ï¼Œå¹¶ä¸”æˆæœ¬æ˜¾è‘—é™ä½ -- `next-mdx-enhanced`æ˜¯ä¸€ä¸ªéå¸¸é‡çš„åº“ï¼Œæœ‰å¾ˆå¤šè‡ªå®šä¹‰é€»è¾‘å’Œ[ä¸€äº›ä»¤äººè®¨åŒçš„é™åˆ¶](https://github.com/hashicorp/next-mdx-enhanced/issues/17). æˆ‘ä»¬çš„éæ­£å¼æµ‹è¯•è¡¨æ˜ï¼Œæ„å»ºæ—¶é—´å‡å°‘äº† 50%æˆ–æ›´å¤šã€‚

è‡ªä»è¿™ä¸ªé¡¹ç›®æœ€åˆåˆ›å»ºä»¥æ¥ï¼ŒKent C Dods ä¹Ÿåšäº†ä¸€ä¸ªç±»ä¼¼çš„é¡¹ç›®ï¼Œ[`mdx-bundler`](https://github.com/kentcdodds/mdx-bundler).è¯¥åº“æ”¯æŒåœ¨ mdx æ–‡ä»¶ä¸­å¯¼å…¥å’Œå¯¼å‡ºï¼ˆåªè¦æ‚¨æ‰‹åŠ¨è¯»å–æ¯ä¸ªå¯¼å…¥çš„æ–‡ä»¶å¹¶ä¼ é€’å…¶å†…å®¹ï¼‰ï¼Œå¹¶è‡ªåŠ¨å¤„ç†å‰ç«¯äº‹åŠ¡ã€‚å¦‚æœä½ æœ‰å¾ˆå¤šæ–‡ä»¶éƒ½å¯¼å…¥å¹¶ä½¿ç”¨ä¸åŒçš„ç»„ä»¶ï¼Œä½ å¯èƒ½ä¼šä»ä½¿ç”¨`mdx-bundler`ä¸­å—ç›Šï¼Œå› ä¸º`next-mdx-remote`ç›®å‰åªå…è®¸å¯¼å…¥ç»„ä»¶å¹¶ä½¿å…¶åœ¨æ‰€æœ‰é¡µé¢ä¸Šå¯ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡`mdx-bundler`çš„è¾“å‡ºæ¯”`next-mdx-remote`çš„åŸºæœ¬ markdown å†…å®¹çš„è¾“å‡ºè‡³å°‘å¤§ 400%ï¼Œä½†æ­¤åŠŸèƒ½è¿˜æ˜¯æœ‰æˆæœ¬çš„ã€‚

### å¦‚ä½•ä½¿ç”¨æ­¤åˆ›å»ºåšå®¢ï¼Ÿ

æ•°æ®æ˜¾ç¤ºï¼Œæ‰€æœ‰å¼€å‘äººå‘˜å·¥å…· 99%çš„ç”¨ä¾‹éƒ½åœ¨æ„å»ºä¸å¿…è¦çš„å¤æ‚ä¸ªäººåšå®¢ã€‚åªæ˜¯å¼€ç©ç¬‘ã€‚ä½†è¯´çœŸçš„ï¼Œå¦‚æœä½ æƒ³ä¸ºä¸ªäººæˆ–å°ä¼ä¸šåˆ›å»ºä¸€ä¸ªåšå®¢ï¼Œå¯ä»¥è€ƒè™‘åªä½¿ç”¨æ™®é€šçš„ html å’Œ cssã€‚ä½ ç»å¯¹ä¸éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ²‰é‡çš„å…¨æ ˆ javascript æ¡†æ¶æ¥åˆ¶ä½œä¸€ä¸ªç®€å•çš„åšå®¢ã€‚å‡ å¹´åï¼Œå½“ä½ å›æ¥è¿›è¡Œæ›´æ–°æ—¶ï¼Œä½ ä¼šæ„Ÿè°¢è‡ªå·±ï¼Œå› ä¸ºä½ çš„æ‰€æœ‰ä¾èµ–é¡¹è¿˜æ²¡æœ‰ 10 ä¸ªçªç ´æ€§çš„ç‰ˆæœ¬ã€‚

å¦‚æœä½ çœŸçš„åšæŒï¼Œè¯·æŸ¥çœ‹[æˆ‘ä»¬çš„å®˜æ–¹ nextjs ç¤ºä¾‹å®ç°](https://github.com/vercel/next.js/tree/canary/examples/with-mdx-remote). ğŸ’–

## Caveats

### ç¯å¢ƒç›®æ ‡

`next-mdx-remote`ç”Ÿæˆçš„ä»£ç ï¼Œç”¨äºå®é™…å‘ˆç°æ”¯æŒæ¨¡å—çš„ mdx ç›®æ ‡æµè§ˆå™¨ã€‚å¦‚æœéœ€è¦æ”¯æŒè¾ƒæ—§çš„æµè§ˆå™¨ï¼Œè¯·è€ƒè™‘ä»`serialize`è½¬æ¢`compiledSource`è¾“å‡ºã€‚

### `import` / `export`

`import` and `export`è¯­å¥ä¸èƒ½åœ¨**MDX æ–‡ä»¶å†…**ä½¿ç”¨ã€‚å¦‚æœæ‚¨éœ€è¦åœ¨ MDX æ–‡ä»¶ä¸­ä½¿ç”¨ç»„ä»¶ï¼Œåˆ™åº”å°†å®ƒä»¬ä½œä¸ºå±æ€§æä¾›ç»™`<MDXRemote />`ã€‚

å¸Œæœ›è¿™æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºä¸ºäº†å·¥ä½œï¼Œå¯¼å…¥å¿…é¡»ç›¸å¯¹äºæ–‡ä»¶è·¯å¾„ï¼Œå¹¶ä¸”è¯¥åº“å…è®¸ä»ä»»ä½•åœ°æ–¹åŠ è½½å†…å®¹ï¼Œè€Œä¸æ˜¯ä»…ä»è®¾ç½®çš„æ–‡ä»¶è·¯å¾„åŠ è½½æœ¬åœ°å†…å®¹ã€‚è‡³äºå¯¼å‡ºï¼ŒMDX å†…å®¹è¢«è§†ä¸ºæ•°æ®ï¼Œè€Œä¸æ˜¯**æ¨¡å—**ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•è®¿é—®ä»»ä½•å¯èƒ½ä»ä¼ é€’ç»™ `next-mdx-remote`çš„ MDX å¯¼å‡ºçš„å€¼ã€‚

## å®‰å…¨

è¿™ä¸ªåº“åœ¨å®¢æˆ·ç«¯è¯„ä¼°ä¸€ä¸ª JavaScript å­—ç¬¦ä¸²ï¼Œè¿™å°±æ˜¯å®ƒ MDX è¡¨ç¤º MDX å†…å®¹çš„æ–¹å¼ã€‚å¦‚æœä¸å°å¿ƒï¼Œå°†å­—ç¬¦ä¸²æ±‚å€¼ä¸º javascript å¯èƒ½æ˜¯ä¸€ç§å±é™©çš„åšæ³•ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¼•å‘ XSS æ”»å‡»ã€‚é‡è¦çš„æ˜¯è¦ç¡®ä¿æ‚¨åªå°†`serialize`å‡½æ•°ç”Ÿæˆçš„`mdxSource`è¾“å…¥ä¼ é€’ç»™`<MDXRemote />`ï¼Œå¦‚æ–‡æ¡£ä¸­æ‰€è¿°ã€‚ **ä¸è¦å°†ç”¨æˆ·è¾“å…¥ä¼ é€’åˆ°`<MDXRemote />`ã€‚**

å¦‚æœæ‚¨çš„ç½‘ç«™ä¸Šæœ‰ä¸€ä¸ª CSPï¼Œä¸å…è®¸é€šè¿‡`eval`æˆ–`new Function()`è¿›è¡Œä»£ç è¯„ä¼°ï¼Œåˆ™éœ€è¦æ”¾å®½è¯¥é™åˆ¶æ‰èƒ½ä½¿ç”¨`next-mdx-remote`ï¼Œè¿™å¯ä»¥ä½¿ç”¨[`unsafe-eval`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src#common_sources)æ¥å®Œæˆ.

## TypeScript

æ­¤é¡¹ç›®ä¸åŒ…æ‹¬ç”¨äº TypeScript çš„æœ¬æœºç±»å‹ã€‚`serialize`å’Œ`<MDXRemote />`é€šå¸¸éƒ½æœ‰æ‚¨æ‰€æœŸæœ›çš„ç±»å‹ï¼Œå¹¶ä¸”åº“è¿˜å¯¼å‡ºä¸€ä¸ªç±»å‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥ç±»å‹é”®å…¥`getStaticProps`çš„ç»“æœã€‚

- `MDXRemoteSerializeResult<TScope = Record<string, unknown>>`:è¡¨ç¤º`serialize`çš„è¿”å›å€¼ã€‚å¯ä»¥ä¼ é€’`TScope`æ³›å‹ç±»å‹æ¥è¡¨ç¤ºä¼ å…¥çš„ä½œç”¨åŸŸæ•°æ®çš„ç±»å‹ã€‚

ä¸‹é¢æ˜¯ TypeScript ä¸­ä¸€ä¸ªç®€å•å®ç°çš„ç¤ºä¾‹ã€‚å¯¹äº TypeScript çš„æ¯ä¸ªé…ç½®ï¼Œæ‚¨å¯èƒ½ä¸éœ€è¦å®Œå…¨ä»¥è¿™ç§æ–¹å¼å®ç°ç±»å‹â€”â€”æ­¤ç¤ºä¾‹åªæ˜¯æ¼”ç¤ºäº†åœ¨éœ€è¦æ—¶å¯ä»¥åº”ç”¨ç±»å‹çš„ä½ç½®ã€‚

```tsx
import { GetStaticProps } from "next";
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote, MDXRemoteSerializeResult } from "next-mdx-remote";
import ExampleComponent from "./example";

const components = { ExampleComponent };

interface Props {
  mdxSource: MDXRemoteSerializeResult;
}

export default function ExamplePage({ mdxSource }: Props) {
  return (
    <div>
      <MDXRemote {...mdxSource} components={components} />
    </div>
  );
}

export const getStaticProps: GetStaticProps<{
  mdxSource: MDXRemoteSerializeResult;
}> = async () => {
  const mdxSource = await serialize("some *mdx* content: <ExampleComponent />");
  return { props: { mdxSource } };
};
```

## React æœåŠ¡å™¨ç»„ä»¶ï¼ˆRSCï¼‰&Next.js`app`ç›®å½•æ”¯æŒ

> **è­¦å‘Š**
> æˆ‘ä»¬è®¤ä¸º`next-mdx-remote/rsc` API æ˜¯ä¸ç¨³å®šçš„ã€‚è¯·è‡ªè¡Œä½¿ç”¨ï¼Œå¹¶æ³¨æ„ API å’Œè¡Œä¸ºå¯èƒ½ä¼šåœ¨æ¬¡è¦ç‰ˆæœ¬å’Œ/æˆ–è¡¥ä¸ç‰ˆæœ¬ä¹‹é—´å‘ç”Ÿå˜åŒ–ã€‚

ä»`next-mdx-remote/rsc`å¯¼å…¥æ”¯æŒåœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ next.js çš„`app`ç›®å½•ä¸­ä½¿ç”¨`next-mdx-remote`ã€‚ä»¥å‰ï¼Œåºåˆ—åŒ–å’Œæ¸²æŸ“æ­¥éª¤æ˜¯åˆ†å¼€çš„ï¼Œä½†ä»¥åçš„ RSC ä½¿è¿™ç§åˆ†ç¦»å˜å¾—ä¸å¿…è¦ã€‚

ä¸€äº›å€¼å¾—æ³¨æ„çš„å·®å¼‚:

- `<MDXRemote />`ç°åœ¨æ¥å—`source`å±æ€§ï¼Œè€Œä¸æ˜¯æ¥å—`next-mdx-remote/serialize`çš„åºåˆ—åŒ–è¾“å‡º
- ç”±äº RSC ä¸æ”¯æŒ react contextï¼Œå› æ­¤æ— æ³•å†ä½¿ç”¨`@mdx-js/react`ä¸­çš„`MDXProvider`ä¸Šä¸‹æ–‡æä¾›è‡ªå®šä¹‰ç»„ä»¶
- è¦åœ¨ä¼ é€’`parseFrontmatter: true`æ—¶è®¿é—® MDX ä¹‹å¤–çš„ frontmatterï¼Œè¯·ä½¿ç”¨`next-MDX-remote/rsc`ä¸­å…¬å¼€çš„`compileMdx`æ–¹æ³•
- ç”±äºæ¸²æŸ“å‘ç”Ÿåœ¨æœåŠ¡å™¨ä¸Šï¼Œå› æ­¤ä¸å†æ”¯æŒ`lazy`å±æ€§
- `<MDXRemote />`å¿…é¡»åœ¨æœåŠ¡å™¨ä¸Šå‘ˆç°ï¼Œå› ä¸ºå®ƒç°åœ¨æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ã€‚å®¢æˆ·ç«¯ç»„ä»¶å¯ä»¥ä½œä¸º MDX æ ‡è®°çš„ä¸€éƒ¨åˆ†å‘ˆç°

æœ‰å…³ RSC çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[Next.js æ–‡æ¡£](https://nextjs.org/docs/app/building-your-application/rendering/server-components).

### ç¤ºä¾‹

_å‡è®¾åœ¨ä½¿ç”¨`app`ç›®å½•çš„ Next.js 13+åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚_

#### åŸºæœ¬çš„

```tsx
import { MDXRemote } from "next-mdx-remote/rsc";

// app/page.js
export default function Home() {
  return (
    <MDXRemote
      source={`# Hello World

      This is from Server Components!
      `}
    />
  );
}
```

#### åŠ è½½çŠ¶æ€

```tsx
import { MDXRemote } from "next-mdx-remote/rsc";

// app/page.js
export default function Home() {
  return (
    // Ideally this loading spinner would ensure there is no layout shift,
    // this is an example for how to provide such a loading spinner.
    // In Next.js you can also use `loading.js` for this.
    <Suspense fallback={<>Loading...</>}>
      <MDXRemote
        source={`# Hello World

        This is from Server Components!
        `}
      />
    </Suspense>
  );
}
```

#### è‡ªå®šä¹‰ç»„ä»¶

```tsx
// components/mdx-remote.js
import { MDXRemote } from "next-mdx-remote/rsc";

const components = {
  h1: (props) => (
    <h1 {...props} className="large-text">
      {props.children}
    </h1>
  ),
};

export function CustomMDX(props) {
  return <MDXRemote {...props} components={{ ...components, ...(props.components || {}) }} />;
}
```

```tsx
// app/page.js
import { CustomMDX } from "../components/mdx-remote";

export default function Home() {
  return (
    <CustomMDX
      // h1 now renders with `large-text` className
      source={`# Hello World
      This is from Server Components!
    `}
    />
  );
}
```

#### è®¿é—® MDX ä¹‹å¤–çš„ Frontmatter

```tsx
// app/page.js
import { compileMDX } from "next-mdx-remote/rsc";

export default async function Home() {
  // Optionally provide a type for your frontmatter object
  const { content, frontmatter } = await compileMDX<{ title: string }>({
    source: `---
title: RSC Frontmatter Example
---
# Hello World
This is from Server Components!
`,
    options: { parseFrontmatter: true },
  });
  return (
    <>
      <h1>{frontmatter.title}</h1>
      {content}
    </>
  );
}
```

## è®¸å¯è¯

[Mozilla å…¬å…±è®¸å¯è¯ 2.0 ç‰ˆ](./LICENSE)
